<!DOCTYPE html>
<html>
<head>
  <title>Project4</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <script src="//connect.soundcloud.com/sdk-2.0.0.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <%= csrf_meta_tags %>
</head>
<body>
  <div class="row">
    <div class="col s12 m12 l12">
      <canvas id="soundhopper" style="background-color:black"></canvas>
    </div>
  </div>

<%= yield %>

</body>
<script>
//my use of webaudiox
var context	= new AudioContext()
// Create lineOut
var lineOut	= new WebAudiox.LineOut(context)
lineOut.volume	= 0.2
var analyser	= context.createAnalyser()
analyser.connect(lineOut.destination);
lineOut.destination	= analyser;
// load a sound and play it immediatly

var canvas	= document.getElementById('soundhopper');
canvas.width = window.innerWidth
canvas.height = 400;
var ctx		= canvas.getContext("2d");
document.body.appendChild(canvas)
// create the object
var analyser2canvas	= new WebAudiox.Analyser2Canvas(analyser, canvas)
// loop and update
requestAnimationFrame(function update() {
requestAnimationFrame(update);
// clear the canvas
ctx.clearRect(0, 0, canvas.width, canvas.height);
// put the sound in the canvas
analyser2canvas.update()
});
<% @soundc.each do |x| %>
var button<%= x['id'] %> = document.getElementById('play-button<%= x['id'] %>');
button<%= x['id'] %>.addEventListener("click", function() {
  WebAudiox.loadBuffer(context, "<%= x['stream_url'] %>?client_id=<%=ENV['SoundCloudKey']%>", function(buffer){
    var source	= context.createBufferSource()
  source.buffer	= buffer
  source.loop	= true
  source.connect(lineOut.destination)
  source.start(0);
});
});
<% end %>
</script>
</html>
